<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.NotificationDAO">

	<!-- 알림 추가 -->
	<insert id="add_notification">
		INSERT INTO notifications (follower_id, following_id, boardNo, post_id)
		VALUES (#{follower_id},#{following_id},#{boardNo},#{post_id})
	</insert>

	<!-- 알림 보기 -->
    <select id="notification_list" resultType="com.boot.dto.NotificationDTO">
    	select notifications_id
    		 , follower_id
    		 , following_id
    		 , boardNo
    		 , post_id
    		 , is_read
    		 , created_at
    	  from notifications
    	 where follower_id = #{follower_id}
    	 ORDER BY notifications_id DESC
    </select>

	<!-- 안 읽은 알림 보기 -->
    <select id="notification_list_n" resultType="com.boot.dto.NotificationDTO">
    	select notifications_id
    		 , follower_id
    		 , following_id
    		 , n.boardNo
    		 , post_id
    		 , is_read
    		 , created_at
    		 , m.mf_nickname as nickname
    		 , t.boardTitle as board_title
    	  from notifications n
    	  join matflix m
    	    on n.following_id = m.mf_no
    	  join tbl_board t
    	    on n.boardNo = t.boardNo
    	 where follower_id = #{follower_id}
    	   and is_read = 0
    	 ORDER BY notifications_id DESC
    </select>
    
    <!-- 알림 읽음 처리 -->
    <update id="is_read_true">
    	update notifications
    	   set is_read = 1
    	 where notifications_id=#{notifications_id}
    </update>
    
    <!-- 알림 갯수 카운트 -->
    <select id="notification_count" resultType="int">
    	select count(*)
    	  from notifications
    	 where follower_id = #{follower_id}
    	   and is_read = 0
    </select>
    
    <!-- 알림 삭제 -->
	<delete id="delete_notification">
		DELETE n
		  FROM notifications n
		  JOIN (
		       SELECT notifications_id
		         FROM notifications
		        WHERE follower_id = #{mf_no}
				   OR following_id = #{mf_no}
			   ) t ON n.notifications_id = t.notifications_id;
	</delete>
</mapper>